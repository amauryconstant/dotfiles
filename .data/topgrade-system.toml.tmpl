# Topgrade System Configuration
# Purpose: System-level maintenance for topgrade-maintenance user
# Location: /etc/topgrade/topgrade.toml
# User: topgrade-maintenance (automated system maintenance)

[misc]
# Disable confirmation prompts for automated execution
assume_yes = true
# Cleanup temporary or old files after updates
cleanup = true
# Do not ask to retry failed steps
no_retry = true
# Sudo command to be used
sudo_command = "sudo"
# Disable specific steps - exclude development tools handled separately
disable = [
    "cargo",
    "pip3",
    "node",
    "yarn",
    "pnpm",
    "composer",
    "gem",
    "go",
    "deno",
    "bun",
    "uv",
]

# Package managers configuration
[linux]
# Use paru if available, fallback to pacman
arch_package_manager = "paru"
# Show Arch news during updates
show_arch_news = true

# System maintenance
[firmware]
# Update firmware when available
upgrade = true

# Flatpak configuration
[flatpak]
# Use sudo for system-wide flatpak operations (required for topgrade-maintenance user)
use_sudo = true

# Git repositories - maintenance user has no personal repositories
# [git] section intentionally omitted for security isolation
# Personal git repositories should be managed from user accounts

# Pre-update commands - maintenance user cannot access user scripts
# [pre_commands] section intentionally omitted for security boundaries
# The maintenance user doesn't have access to ~/.config/shell/env_functions

# Core system maintenance operations
[commands]
# Clean package cache after updates
"Clean package cache" = "sudo pacman -Sc --noconfirm"
# Remove orphaned packages (safe version - checks for orphans before attempting removal)
"Remove orphaned packages" = "bash -c 'orphans=$(pacman -Qtdq 2>/dev/null); [ -n \"$orphans\" ] && sudo pacman -Rns $orphans --noconfirm || true'"
