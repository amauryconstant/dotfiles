#!/bin/sh

{{ if eq .osId "linux-arch" }}

    # Install yay is not already present
    if ! command -v yay &> /dev/null; then
        # Install yay through pacman
        sudo pacman -S --needed yay

        # Initialize yay
        yay -Y --gendb
        yay -Syu --devel
    fi

    # Install and rate Arch mirrors
    yay -S --noconfirm rate-mirrors
    rate-mirrors --protocol https arch | sudo tee /etc/pacman.d/mirrorlist

{{ else }}
    echo "ERROR: This script is only supported on Arch Linux systems"
    echo "Required: osId 'linux-arch'"
    echo "Detected: '{{ .osId }}'"
    echo "Script: $(basename "$0")"
    exit 1
{{ end }}
