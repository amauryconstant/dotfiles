#!/bin/sh

# Script: run_onchange_before_create_git_hooks.sh.tmpl
# Purpose: Create git hooks from .gitscripts directory
# Requirements: Arch Linux, git

{{ includeTemplate "log_start" "Creating git hooks..." }}

# Set strict error handling
set -euo pipefail

# Check if .gitscripts directory exists
if [ ! -d "{{ .chezmoi.sourceDir }}/.gitscripts" ]; then
    {{ includeTemplate "log_skip" "No .gitscripts directory found, skipping git hooks creation" }}
    exit 0
fi

# Create hooks directory if it doesn't exist
mkdir -p "{{ .chezmoi.sourceDir }}/.git/hooks"

# Copy and make executable all scripts from .gitscripts
for script in "{{ .chezmoi.sourceDir }}/.gitscripts"/*; do
    if [ -f "$script" ]; then
        hook_name=$(basename "$script")
        {{ includeTemplate "log_step" "Installing git hook: $hook_name" }}
        cp "$script" "{{ .chezmoi.sourceDir }}/.git/hooks/$hook_name"
        chmod +x "{{ .chezmoi.sourceDir }}/.git/hooks/$hook_name"
    fi
done

{{ includeTemplate "log_complete" "Git hooks setup completed successfully" }}
