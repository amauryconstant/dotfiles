#!/usr/bin/env sh

# Script: run_once_before_007_install_chezmoi_modify_manager.sh.tmpl
# Purpose: Install chezmoi_modify_manager for intelligent config file management
# Requirements: Arch Linux, yay

{{ includeTemplate "log_start" "Installing chezmoi_modify_manager..." }}

# Set strict error handling
set -euo pipefail

# Check if chezmoi_modify_manager is already installed
if command -v chezmoi_modify_manager >/dev/null 2>&1; then
    {{ includeTemplate "log_info" "chezmoi_modify_manager already installed" }}
    exit 0
fi

{{ includeTemplate "log_step" "Installing chezmoi_modify_manager from AUR..." }}

# Install chezmoi_modify_manager using yay
if yay -S --noconfirm chezmoi_modify_manager; then
    {{ includeTemplate "log_success" "chezmoi_modify_manager installed successfully" }}
else
    {{ includeTemplate "log_error" "Failed to install chezmoi_modify_manager" }}
    exit 1
fi

# Verify installation
if command -v chezmoi_modify_manager >/dev/null 2>&1; then
    {{ includeTemplate "log_success" "chezmoi_modify_manager installation verified" }}
else
    {{ includeTemplate "log_error" "chezmoi_modify_manager installation verification failed" }}
    exit 1
fi

{{ includeTemplate "log_complete" "chezmoi_modify_manager setup completed successfully" }}