#!/usr/bin/env sh

{{ if eq .chezmoi.osRelease.id "endeavouros" }}

{{ includeTemplate "log_start" "Setting up EndeavourOS-specific configurations..." }}

{{ includeTemplate "log_step" "Optimizing EndeavourOS mirrors..." }}
rate-mirrors --protocol https endeavouros | sudo tee /etc/pacman.d/endeavouros-mirrorlist

{{ includeTemplate "log_step" "Running EndeavourOS system update..." }}
eos-update

{{ includeTemplate "log_step" "Installing NVIDIA installer..." }}
yay -S --noconfirm nvidia-inst

{{ includeTemplate "log_step" "Installing NVIDIA drivers..." }}
nvidia-inst -of --no-dkms

{{ includeTemplate "log_step" "Running NVIDIA kernel update check..." }}
eos-kernel-nvidia-update-check

{{ includeTemplate "log_complete" "EndeavourOS-specific setup completed" }}

{{ else }}
{{ includeTemplate "os_error" (dict "required" "EndeavourOS" "detected" .chezmoi.osRelease.id) }}
{{ end }}
