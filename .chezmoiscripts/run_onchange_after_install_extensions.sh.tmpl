#!/bin/sh

# Script: run_onchange_after_install_extensions.sh.tmpl
# Purpose: Install VSCode extensions and configure Firefox policies
# Requirements: Linux
# Hash: {{ include ".data/firefox-policies.json" | sha256sum }}

{{ if eq .chezmoi.os "linux" }}

    # Install code extensions
    {{ range .extensions.code -}}
        echo {{.}}
        code --force --install-extension {{.}}
    {{ end -}}

    # firefox-policies.json hash: {{ include ".data/firefox-policies.json" | sha256sum }}
    echo "Copying firefox polices"
    sudo mkdir -p /etc/firefox/policies
    sudo cp -v {{ .chezmoi.config.workingTree }}/.data/firefox-policies.json /etc/firefox/policies/policies.json

{{ else }}
    echo "ERROR: This script is only supported on Linux systems"
    echo "Required: OS 'linux'"
    echo "Detected: '{{ .chezmoi.os }}'"
    echo "Script: $(basename "$0")"
    exit 1
{{ end }}
