#!/usr/bin/env sh

# Script: run_once_after_002_generate_and_config_cli.sh.tmpl
# Purpose: Configure CLI tools and shell environment
# Requirements: Arch Linux

{{ includeTemplate "log_start" "Configuring CLI tools and shell environment..." }}

# Set strict error handling
set -eu

# Configure zsh as default shell if installed
if command -v zsh >/dev/null 2>&1; then
    CURRENT_SHELL=$(getent passwd "$USER" | cut -d: -f7)
    ZSH_PATH=$(which zsh)

    if [ "$CURRENT_SHELL" = "$ZSH_PATH" ]; then
        {{ includeTemplate "log_success" "zsh already set as default shell" }}
    else
        {{ includeTemplate "log_step" "Setting zsh as default shell..." }}
        chsh -s "$ZSH_PATH"
        {{ includeTemplate "log_success" "zsh set as default shell (logout/login to apply)" }}
    fi
else
    {{ includeTemplate "log_skip" "zsh not installed, skipping" }}
fi

# Initialize mise
if command -v mise >/dev/null 2>&1; then
    {{ includeTemplate "log_step" "Installing mise tools..." }}
    mise install
    {{ includeTemplate "log_success" "mise tools installed" }}
else
    {{ includeTemplate "log_skip" "mise not installed, skipping" }}
fi

{{ includeTemplate "log_complete" "CLI configuration completed successfully" }}
