#!/bin/sh

# Script: run_once_before_005_install_zsh.sh.tmpl
# Purpose: Install zsh, ghostty terminal, and starship prompt
# Requirements: Arch Linux
# Supported Distributions: Arch Linux, EndeavourOS

{{- template "chezmoi_logger_setup" . }}

{{ if eq .osId "linux-arch" }}

log_step "Installing zsh and terminal environment"

# Define packages to install
PACKAGES="ghostty zsh zsh-antidote starship"

log_info "Installing terminal packages: $PACKAGES"
log_dry_run "install" "$PACKAGES via yay"

if [ "${CHEZMOI_DRY_RUN:-false}" != "true" ]; then
    # Install packages
    if yay -S --noconfirm $PACKAGES; then
        log_success "Successfully installed terminal packages"
    else
        handle_error "Failed to install terminal packages" 1
    fi
    
    # Change shell to zsh
    log_info "Changing default shell to zsh"
    if chsh -s $(which zsh); then
        log_success "Default shell changed to zsh"
        log_info "Note: You may need to log out and back in for the shell change to take effect"
    else
        log_warn "Failed to change default shell to zsh - you may need to do this manually"
    fi
else
    log_info "Would change default shell to zsh"
fi

log_success "zsh and terminal environment setup completed"

{{ else }}
    log_error "This script is only supported on Arch Linux systems"
    log_error "Required: osId 'linux-arch'"
    log_error "Detected: '{{ .osId }}'"
    log_error "Script: $(basename "$0")"
    exit 1
{{ end }}
