#!/usr/bin/env zsh

# commands - List all available custom commands and tools
# Purpose: Discover available CLI tools and their descriptions
# Usage: commands [search_term]

commands() {
    local search_term="$1"
    local script_dir="$HOME/.local/lib/scripts"
    local bin_dir="$HOME/.local/bin"

    echo "ðŸ”§ Available Custom Commands:"
    echo ""

    if [[ -n "$search_term" ]]; then
        echo "ðŸ” Searching for: $search_term"
        echo ""
    fi

    local -a wrappers=(${bin_dir}/^test-*(N:t))
    for wrapper in "${wrappers[@]}"; do
        [[ -n "$search_term" && ! "$wrapper" =~ "$search_term" ]] && continue

        local raw_desc desc
        raw_desc=$(grep -m1 "^# Purpose:" "$bin_dir/$wrapper" 2>/dev/null)
        desc=${raw_desc#'# Purpose: '}
        [[ -z "$desc" || "$desc" == "$raw_desc" ]] && desc="CLI wrapper for $wrapper"

        printf "  %-20s %s\n" "$wrapper" "$desc"
    done

    echo ""
    echo "ðŸ“š Available Script Categories:"
    echo ""

    local -a categories=(${script_dir}/^lib/(N/:t))
    for category in "${categories[@]}"; do
        local -a scripts=(${script_dir}/${category}/*(N))
        printf "  %-20s %d scripts\n" "$category" "${#scripts[@]}"
    done

    echo ""
    echo "ðŸ’¡ Usage:"
    echo "  commands [search]    - Search for specific commands"
    echo "  <command> --help     - Get help for specific command"
}
