# Topgrade Configuration
# Purpose: System-level maintenance and updates for Arch Linux
# Template Variables: Uses chezmoi template system for user-specific configuration

[misc]
# Disable confirmation prompts for automated execution
assume_yes = true
# Cleanup temporary or old files after updates
cleanup = true
# Do not ask to retry failed steps
no_retry = true
# Sudo command to be used
sudo_command = "sudo"
# Disable specific steps - exclude development tools handled separately
disable = [
    "cargo",
    "pip3",
    "node",
    "yarn",
    "pnpm",
    "composer",
    "gem",
    "go",
    "deno",
    "bun",
    "uv",
]

# Package managers configuration
[linux]
# Use yay if available, fallback to pacman
arch_package_manager = "yay"
# Show Arch news during updates
show_arch_news = true

# System maintenance
[firmware]
# Update firmware when available
upgrade = true

# Git repositories maintenance
[git]
# How many repos to pull at max in parallel
max_concurrency = 5
# Additional git repositories to pull
repos = [
    "~/.local/share/chezmoi",
    "~/Projects/*"
]
# Arguments to pass Git when pulling repositories
arguments = "--rebase --autostash"

# Pre-update commands (run before any updates)
[pre_commands]
# System health check before updates
"System health check" = "/usr/bin/zsh -c 'system_health_simple --brief'"
# Strategy-aware package health check
"Package health check" = "{{ .chezmoi.homeDir }}/.config/scripts/package-manager.sh health --brief"

# Custom commands for system-specific maintenance
[commands]
# Clean package cache after updates
"Clean package cache" = "sudo pacman -Sc --noconfirm"
# Remove orphaned packages
"Remove orphaned packages" = "sudo pacman -Rns $(pacman -Qtdq) --noconfirm || true"
# Post-update system status
"Post-update system status" = "/usr/bin/zsh -c 'system_health_simple --brief'"
# Post-update package strategy validation
"Package strategy validation" = "{{ .chezmoi.homeDir }}/.config/scripts/package-manager.sh health --brief"
