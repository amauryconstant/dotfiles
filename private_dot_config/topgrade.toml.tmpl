# Topgrade Configuration
# Purpose: System-level maintenance and updates for Arch Linux
# Template Variables: Uses chezmoi template system for user-specific configuration

[misc]
# Disable confirmation prompts for automated execution
assume_yes = true
# Cleanup temporary or old files after updates
cleanup = true
# Do not ask to retry failed steps
no_retry = true
# Sudo command to be used
sudo_command = "sudo"
# Disable specific steps - exclude development tools handled separately
disable = [
    "cargo",
    "pip3",
    "node",
    "yarn",
    "pnpm",
    "composer",
    "gem",
    "go",
    "deno",
    "bun",
    "uv",
    "system",    # Disable pacman/paru (handled by package-manager)
    "flatpak",   # Disable flatpak (handled by package-manager)
]

# Package managers configuration
[linux]
# DISABLED: Package management handled by package-manager.sh
# arch_package_manager = "paru"
# Show Arch news during updates
show_arch_news = true

# System maintenance
[firmware]
# Update firmware when available
upgrade = true

# Flatpak configuration
[flatpak]
# DISABLED: Flatpak management handled by package-manager.sh
# use_sudo = true

# Git repositories maintenance
[git]
# How many repos to pull at max in parallel
max_concurrency = 5
# Additional git repositories to pull
repos = [
    "~/.local/share/chezmoi",
    "~/Projects/*"
]
# Arguments to pass Git when pulling repositories
arguments = "--rebase --autostash --prune"

# Pre-update commands (run before any updates)
[pre_commands]
"Package Update (package-manager)" = "{{ .chezmoi.homeDir }}/.local/bin/package-manager update"

# Custom commands for system-specific maintenance
[commands]
# Post-update system status
"Post-update system status" = "{{ .chezmoi.homeDir }}/.local/bin/system-health --brief"
# Check for unmanaged packages (installed outside dotfiles)
"Check for unmanaged packages" = "{{ .chezmoi.homeDir }}/.local/bin/package-manager merge --dry-run"
# Remove orphaned packages (safe version - checks for orphans before attempting removal)
"Remove orphaned packages" = "bash -c 'orphans=$(pacman -Qtdq 2>/dev/null); [ -n \"$orphans\" ] && sudo pacman -Rns $orphans --noconfirm || true'"
