#!/usr/bin/env sh

# Script: system-menu.sh
# Purpose: Main menu entry point - called by Super+Space keybinding
#          Displays 10 categories, routes to submenus
# Requirements: Arch Linux, wofi
# Adapted from: Omarchy's omarchy-menu
# Note: Do not confuse with menu-system.sh (power management submenu)

# Source helpers
. "$SCRIPTS_DIR/user-interface/menu-helpers.sh"

# Load menu extensions (optional)
MENU_EXTEND_HOOK="$HOME/.config/dotfiles/hooks/menu-extend"
EXTRA_OPTIONS=""
if [ -x "$MENU_EXTEND_HOOK" ]; then
    EXTRA_OPTIONS=$("$MENU_EXTEND_HOOK" options 2>/dev/null || true)
fi

# Main menu options (9 categories) - Using Material Design icons
MAIN_OPTIONS="󰀻 Apps|󰗚 Learn|󰈿 Trigger|󰏘 Style|󰒓 Setup|󰏓 Install|󰚰 Update|󰋼 About|󰐥 System"
[ -n "$EXTRA_OPTIONS" ] && MAIN_OPTIONS="${MAIN_OPTIONS}|${EXTRA_OPTIONS}"

CHOICE=$(show_menu "Main Menu" "$MAIN_OPTIONS")

case "$CHOICE" in
    "󰀻 Apps")
        # Launch application launcher
        wofi --show drun
        ;;
    "󰗚 Learn")
        "$SCRIPTS_DIR/user-interface/menu-learn.sh"
        ;;
    "󰈿 Trigger")
        "$SCRIPTS_DIR/user-interface/menu-trigger.sh"
        ;;
    "󰏘 Style")
        "$SCRIPTS_DIR/user-interface/menu-style.sh"
        ;;
    "󰒓 Setup")
        "$SCRIPTS_DIR/user-interface/menu-setup.sh"
        ;;
    "󰏓 Install")
        "$SCRIPTS_DIR/user-interface/menu-install.sh"
        ;;
    # "󰩺 Remove")
    #     "$SCRIPTS_DIR/user-interface/menu-remove.sh"
    #     ;;
    "󰚰 Update")
        "$SCRIPTS_DIR/user-interface/menu-update.sh"
        ;;
    "󰋼 About")
        "$SCRIPTS_DIR/user-interface/menu-about.sh"
        ;;
    "󰐥 System")
        "$SCRIPTS_DIR/user-interface/menu-system.sh"
        ;;
    *)
        # Delegate unknown choices to extension handler
        if [ -n "$CHOICE" ] && [ -x "$MENU_EXTEND_HOOK" ]; then
            "$MENU_EXTEND_HOOK" handle "$CHOICE" 2>/dev/null || true
        fi
        ;;
esac
