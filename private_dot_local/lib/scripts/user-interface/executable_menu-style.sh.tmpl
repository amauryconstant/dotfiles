#!/usr/bin/env sh

# Script: menu-style.sh
# Purpose: Style menu (Theme/Wallpaper/Config)
# Requirements: Arch Linux, wofi

# Source helpers
. "$SCRIPTS_DIR/user-interface/menu-helpers.sh"

# Menu options - Using Material Design icons from glyphnames.json
OPTIONS="󰁍 Back|󰔎 Switch Theme|󰸉 Wallpaper (Random)|󰋩 Wallpaper (Set)|󰒓 Edit Hyprland Config"

CHOICE=$(show_menu "Style" "$OPTIONS")

case "$CHOICE" in
    "󰁍 Back")
        "$SCRIPTS_DIR/user-interface/system-menu.sh"
        ;;
    "󰔎 Switch Theme")
        # Check if theme switcher exists
        if [ -f "$SCRIPTS_DIR/desktop/theme-switcher.sh" ]; then
            "$SCRIPTS_DIR/desktop/theme-switcher.sh"
        else
            notify "󰏘 Theme" "Theme switcher not found"
        fi
        ;;
    "󰸉 Wallpaper (Random)")
        "$SCRIPTS_DIR/media/random-wallpaper.sh"
        ;;
    "󰋩 Wallpaper (Set)")
        # List wallpapers from current theme and let user choose
        CURRENT_THEME_LINK="$HOME/.config/themes/current"
        if [ -L "$CURRENT_THEME_LINK" ]; then
            THEME_NAME="$(basename "$(readlink -f "$CURRENT_THEME_LINK")")"
            WALLPAPER_DIR="$HOME/.config/wallpapers/$THEME_NAME"
        else
            WALLPAPER_DIR=""
        fi

        if [ -n "$WALLPAPER_DIR" ] && [ -d "$WALLPAPER_DIR" ]; then
            WALLPAPER=$(find "$WALLPAPER_DIR" -type f \( -name "*.jpg" -o -name "*.png" -o -name "*.webp" \) | \
                sed "s|$WALLPAPER_DIR/||" | \
                wofi --dmenu --prompt "Select Wallpaper" --width 400 --height 600)
            if [ -n "$WALLPAPER" ]; then
                "$SCRIPTS_DIR/media/set-wallpaper.sh" "$WALLPAPER_DIR/$WALLPAPER"
            fi
        else
            notify "󰋩 Wallpaper" "No theme selected or wallpaper directory not found"
        fi
        ;;
    "󰒓 Edit Hyprland Config")
        # Submenu for config files
        CONFIG_OPTIONS="󰁍 Back|󰍹 Monitor|󱃾 Environment|󰌌 Input|󰒓 General|󰐮 Decoration|󰫢 Animations|󰌑 Bindings|󰖲 Window Rules|󰐊 Autostart"
        CONFIG_CHOICE=$(show_menu "Edit Config" "$CONFIG_OPTIONS")

        case "$CONFIG_CHOICE" in
            "󰁍 Back")
                "$SCRIPTS_DIR/user-interface/menu-style.sh"
                ;;
            "󰍹 Monitor")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/monitor.conf
                ;;
            "󱃾 Environment")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/environment.conf
                ;;
            "󰌌 Input")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/input.conf
                ;;
            "󰒓 General")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/general.conf
                ;;
            "󰐮 Decoration")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/decoration.conf
                ;;
            "󰫢 Animations")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/animations.conf
                ;;
            "󰌑 Bindings")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/bindings.conf
                ;;
            "󰖲 Window Rules")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/windowrules.conf
                ;;
            "󰐊 Autostart")
                {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/autostart.conf
                ;;
        esac
        ;;
esac
