#!/usr/bin/env sh

# Script: menu-setup.sh
# Purpose: Setup menu (System configuration tools)
# Requirements: Arch Linux, wofi

# Source helpers
. "$SCRIPTS_DIR/user-interface/menu-helpers.sh"

# Menu options - Using Material Design icons
OPTIONS="󰁍 Back|󰕾 Audio (PulseAudio)|󰓃 Audio Output Switch|󰖩 Network (WiFi)|󰂯 Bluetooth|󰁹 Power Profile|󰍹 Displays|󰌑 Edit Keybindings|󰖳 Input Devices|󰁢 Home Backup"

CHOICE=$(show_menu "Setup" "$OPTIONS")

case "$CHOICE" in
    "󰁍 Back")
        "$SCRIPTS_DIR/user-interface/system-menu.sh"
        ;;
    "󰕾 Audio (PulseAudio)")
        pavucontrol &
        ;;
    "󰓃 Audio Output Switch")
        "$SCRIPTS_DIR/desktop/audio-switch.sh"
        ;;
    "󰖩 Network (WiFi)")
        {{ .globals.applications.terminal }} -e nmtui
        ;;
    "󰂯 Bluetooth")
        blueman-manager &
        ;;
    "󰁹 Power Profile")
        # Show current power profile and allow switching
        if command -v powerprofilesctl >/dev/null 2>&1; then
            CURRENT=$(powerprofilesctl get)
            PROFILE_OPTIONS="󰁍 Back|󰓅 Performance|󰗑 Balanced|󰁼 Power Saver"
            PROFILE_CHOICE=$(show_menu "Power Profile (Current: $CURRENT)" "$PROFILE_OPTIONS")

            case "$PROFILE_CHOICE" in
                "󰁍 Back")
                    "$SCRIPTS_DIR/user-interface/menu-setup.sh"
                    ;;
                "󰓅 Performance")
                    powerprofilesctl set performance
                    notify "󰁹 Power Profile" "Set to Performance"
                    ;;
                "󰗑 Balanced")
                    powerprofilesctl set balanced
                    notify "󰁹 Power Profile" "Set to Balanced"
                    ;;
                "󰁼 Power Saver")
                    powerprofilesctl set power-saver
                    notify "󰁹 Power Profile" "Set to Power Saver"
                    ;;
            esac
        else
            notify "󰁹 Power Profile" "powerprofilesctl not installed"
        fi
        ;;
    "󰍹 Displays")
        # Launch display configuration tool
        if command -v wdisplays >/dev/null 2>&1; then
            wdisplays &
        elif command -v nwg-displays >/dev/null 2>&1; then
            nwg-displays &
        else
            notify "󰍹 Displays" "No display configuration tool found\nInstall wdisplays or nwg-displays"
        fi
        ;;
    "󰌑 Edit Keybindings")
        {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/bindings.conf
        ;;
    "󰖳 Input Devices")
        {{ .globals.applications.terminal }} -e $EDITOR ~/.config/hypr/conf/input.conf
        ;;
    "󰁢 Home Backup")
        {{ .globals.applications.terminal }} -e home-backup
        ;;
esac
