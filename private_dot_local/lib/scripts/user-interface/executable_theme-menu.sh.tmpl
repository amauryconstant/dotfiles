#!/usr/bin/env sh

# Script: theme-menu.sh
# Purpose: Interactive theme selector using Wofi
# Requirements: Arch Linux, Wofi, theme-switcher.sh

THEMES_DIR="$HOME/.config/themes"
CURRENT_LINK="$THEMES_DIR/current"

# Get current theme name
if [ -L "$CURRENT_LINK" ]; then
    CURRENT_THEME=$(readlink "$CURRENT_LINK" | xargs basename)
else
    CURRENT_THEME="none"
fi

# Build theme list with current indicator and variant info
THEME_LIST=""
for theme_dir in "$THEMES_DIR"/*; do
    [ -d "$theme_dir" ] || continue
    theme=$(basename "$theme_dir")
    [ "$theme" = "current" ] && continue

    # Map each theme variant to unique Material Design icon
    case "$theme" in
        catppuccin-latte)
            icon="󰛊"  # md-coffee_outline
            ;;
        catppuccin-mocha)
            icon="󰅶"  # md-coffee
            ;;
        rose-pine-dawn)
            icon="" # md-weather-sunrise
            ;;
        rose-pine-moon)
            icon="󰖚"  # md-weather-sunset
            ;;
        gruvbox-light)
            icon=""  # nf-md-tree
            ;;
        gruvbox-dark)
            icon="󰹩"  # nf-md-tree_outline
            ;;
        solarized-light)
            icon=""  # fa-sun
            ;;
        solarized-dark)
            icon=""  # fa-moon
            ;;
        *)
            icon="󰏘"  # md-palette
            ;;
    esac

    # Add current indicator
    if [ "$theme" = "$CURRENT_THEME" ]; then
        prefix="✓ "
    else
        prefix="  "
    fi

    # Extract display name (titlecase with spaces)
    display_name=$(echo "$theme" | sed 's/-/ /g' | sed 's/\b\(.\)/\u\1/g')

    THEME_LIST="${THEME_LIST}${prefix}${icon} ${display_name}|${theme}\n"
done

# Show menu and get selection
SELECTED=$(printf "%b" "$THEME_LIST" | wofi --dmenu --prompt "Select Theme" --width 400 --height 300 | cut -d'|' -f2)

# Switch to selected theme
if [ -n "$SELECTED" ]; then
    ~/.local/lib/scripts/desktop/theme-switcher.sh switch "$SELECTED"
fi
