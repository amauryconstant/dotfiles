#!/usr/bin/env bash

set -euo pipefail

# ============================================================================
# Pre-Commit Hook: Chezmoi Destroy + Shellcheck Validation
# ============================================================================

# ------------------------------
# Part 1: Chezmoi Destroy (existing functionality)
# ------------------------------

deleted_files=$(git diff --cached --name-status | awk '$1 == "D" {print $2}')

if [ -n "$deleted_files" ]; then
  for file in $deleted_files; do
    echo "Running chezmoi destroy for deleted file: $file"
    chezmoi destroy "$file" || true  # Don't block on chezmoi errors
  done
fi

# ------------------------------
# Part 2: Shellcheck Validation (via mise task)
# ------------------------------

mise run lint:staged
