stages:
  - mirror

mirror-to-github:
  stage: mirror
  image: alpine:latest
  before_script:
    - apk add --no-cache git
    - |
      if [ -z "$GITHUB_ACCESS_TOKEN" ]; then
        echo "ERROR: GITHUB_ACCESS_TOKEN is not set"
        exit 1
      fi
      if [ -z "$GITHUB_REPO_URL" ]; then
        echo "ERROR: GITHUB_REPO_URL is not set (format: username/repository)"
        exit 1
      fi
  script:
    - git remote add github https://${GITHUB_ACCESS_TOKEN}@github.com/${GITHUB_REPO_URL}.git
    - git checkout -B $CI_COMMIT_BRANCH
    - git push github $CI_COMMIT_BRANCH:$CI_COMMIT_BRANCH --force
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
